@page "/"
@using kreddit_app.Data;
@using shared.Model
@inject ApiService apiService

<h3>Opret en ny post</h3>
<PostForm OnPostCreated="HandlePostCreated" />

<h3>Liste over posts</h3>
@if (posts == null || !posts.Any())
{
    <p><em>Indlæser...</em></p>
}
else
{
    <PostsList posts="posts" />
}

@code {
    private List<Post> posts = new List<Post>();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            Console.WriteLine("Henter posts fra API...");

            posts = (await apiService.GetAllPostsAsync()).ToList();
            Console.WriteLine($"Antal posts hentet: {posts.Count}");

            StateHasChanged(); // Opdater UI
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Fejl ved indlæsning af posts: {ex.Message}");
        }
    }

    private void HandlePostCreated(Post newPost)
    {
        posts.Insert(0, newPost); // Tilføj den nye post til listen
        StateHasChanged(); // Sørg for, at UI bliver opdateret
    }
}
